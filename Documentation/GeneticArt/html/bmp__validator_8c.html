<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GeneticArt: src/bmp_validator.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">GeneticArt
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">bmp_validator.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Secure BMP file validator supporting BMP versions 2 through 5.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for bmp_validator.c:</div>
<div class="dyncontent">
<div class="center"><img src="bmp__validator_8c__incl.png" border="0" usemap="#asrc_2bmp__validator_8c" alt=""/></div>
<map name="asrc_2bmp__validator_8c" id="asrc_2bmp__validator_8c">
<area shape="rect" title="Secure BMP file validator supporting BMP versions 2 through 5." alt="" coords="159,5,308,31"/>
<area shape="rect" title=" " alt="" coords="5,79,72,104"/>
<area shape="poly" title=" " alt="" coords="203,33,84,76,82,71,201,28"/>
<area shape="rect" title=" " alt="" coords="97,79,167,104"/>
<area shape="poly" title=" " alt="" coords="219,33,161,73,158,68,216,28"/>
<area shape="rect" title=" " alt="" coords="192,79,275,104"/>
<area shape="poly" title=" " alt="" coords="236,31,236,65,231,65,231,31"/>
<area shape="rect" title=" " alt="" coords="299,79,370,104"/>
<area shape="poly" title=" " alt="" coords="251,28,308,68,305,73,248,33"/>
<area shape="rect" title=" " alt="" coords="394,79,465,104"/>
<area shape="poly" title=" " alt="" coords="266,28,385,71,384,76,264,33"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structBmpInfo.html">BmpInfo</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a565bc4629b2fd8d54116160b3b9a5846" id="r_a565bc4629b2fd8d54116160b3b9a5846"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bmp__validator_8c.html#a565bc4629b2fd8d54116160b3b9a5846">validate_bmp</a> (const char *filename)</td></tr>
<tr class="memdesc:a565bc4629b2fd8d54116160b3b9a5846"><td class="mdescLeft">&#160;</td><td class="mdescRight">Validate a BMP image file for correctness and integrity.  <br /></td></tr>
<tr class="separator:a565bc4629b2fd8d54116160b3b9a5846"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad43fb230d7b7a8586c89c0db15f1cc61" id="r_ad43fb230d7b7a8586c89c0db15f1cc61"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bmp__validator_8c.html#ad43fb230d7b7a8586c89c0db15f1cc61">bmp_is_valid</a> (const char *filename)</td></tr>
<tr class="memdesc:ad43fb230d7b7a8586c89c0db15f1cc61"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks if the given file is a valid BMP.  <br /></td></tr>
<tr class="separator:ad43fb230d7b7a8586c89c0db15f1cc61"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Secure BMP file validator supporting BMP versions 2 through 5. </p>
<p>This module provides a function to validate BMP image files of various versions (BITMAPCOREHEADER, BITMAPINFOHEADER and all extensions up to BITMAPV5HEADER) for structural correctness and integrity. Validation includes checking the BMP file header, DIB header, color masks, color palette, pixel data (with RLE decompression checks), and overall consistency of sizes and offsets. The implementation emphasizes security, avoiding large memory allocations or integer overflows, and handles maliciously crafted files gracefully by rejecting them with detailed error messages. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="ad43fb230d7b7a8586c89c0db15f1cc61" name="ad43fb230d7b7a8586c89c0db15f1cc61"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad43fb230d7b7a8586c89c0db15f1cc61">&#9670;&#160;</a></span>bmp_is_valid()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool bmp_is_valid </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>filename</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks if the given file is a valid BMP. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">filename</td><td>Path to the BMP file. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if the file passes basic format checks, false otherwise. </dd></dl>

</div>
</div>
<a id="a565bc4629b2fd8d54116160b3b9a5846" name="a565bc4629b2fd8d54116160b3b9a5846"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a565bc4629b2fd8d54116160b3b9a5846">&#9670;&#160;</a></span>validate_bmp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool validate_bmp </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>filename</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Validate a BMP image file for correctness and integrity. </p>
<p>Opens the specified file and performs comprehensive validation of the BMP file format. Supports BMP files with DIB headers from the 12-byte OS/2 Core header through the 124-byte BITMAPV5HEADER. If one format check fails, it will attempt others where applicable. Validation steps include:</p><ul>
<li>File header verification (signature "BM", file size consistency).</li>
<li>DIB header parsing (identifying BMP version and reading fields).</li>
<li>Field validation (dimensions, planes, bit depth vs compression, etc.).</li>
<li>Color mask and color palette handling.</li>
<li>Pixel data validation: uncompressed images (row alignment and size checks), RLE-compressed images (byte-stream parsing to validate encoding and image completeness), and embedded JPEG/PNG validation.</li>
<li>Enforcing size limits to avoid processing very large files (files &gt; half of system RAM or &gt;15MB are rejected).</li>
<li>Logging any validation failures to stderr with a clear reason.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">filename</td><td>Path to the BMP file to validate. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>true</code> if the file is a valid BMP that passes all checks, <code>false</code> if any check fails (with an error message printed). </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
